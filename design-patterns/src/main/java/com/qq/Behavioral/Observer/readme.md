# 观察者模式

## 业务

模拟摇号后，将结果推送给用户。

定义统一的返回对象（LotteryResult）。

定义一个摇号服务的接口（MinibusTargetService），内部包含一个简单的摇号规则，判断用户是否中签。

## demo1

按照需求需要在原有的摇号接口（LotteryServiceImpl）中添加 MQ 消息发送以及短消息通知功能，整体过程包括三部分；摇号、发短信、发 MQ 消息，而这部分都是顺序调用的。

但除了**摇号**接口调用外，后面的两部分都是非核心主链路功能，而且会随着后续的业务需求发展而不断的调整和扩充，在这样的开发方式下就非常不利于维护。

## demo2

使用**观察者模式**。

新增观察者接口（EventListener），定义了事件发生时，观察者监听到后如何执行，具体逻辑由实现类决定，分为短信和 mq 观察者。

定义了一个事件处理类（EventManager），用于注册观察者，内部通过 map 存储不同事件类型和对应的观察者列表，可根据传入的事件类型，通知相应的观察者执行 doEvent 方法。

核心流程不会轻易改变，但辅助流程会随着业务的各种变化而变化，当需要新增其他的监听事件或者修改监听逻辑，是不需要改动事件处理类。